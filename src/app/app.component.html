<div>
  <div [ngClass]="cswLoading ? 'loading' : 'loaded'">
    <div *ngIf="cswLoading">
      <mat-spinner style="margin: auto"></mat-spinner>
      <p style="text-align: center; margin-top: 1em">
        NGR metadata records inladen
      </p>
    </div>
    <table
      *ngIf="!cswLoading"
      mat-table
      [dataSource]="dataView"
      class="mat-elevation-z8"
      style="width: 100vw"
    >
      <ng-container matColumnDef="mdId">
        <th mat-header-cell *matHeaderCellDef>metadata-identifier</th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="getMatchedClass(element)"
        >
          <ng-template
            [ngIf]="element.csvMatched !== csvMatched.RecordNotInCatalog"
            [ngIfElse]="recordNotInCatalog"
          >
            <a
              href="https://www.nationaalgeoregister.nl/geonetwork/srv/dut/catalog.search#/metadata/{{
                element.mdId
              }}"
              >{{ element.mdId }}</a
            >
          </ng-template>

          <ng-template #recordNotInCatalog>
            <span
              [title]="
                'record (' +
                element.mdId +
                ') from CSV file not found in catalog'
              "
              >{{ element.mdId }}</span
            >
          </ng-template>
        </td>
      </ng-container>

      <!-- Name Column -->
      <ng-container matColumnDef="resourceOwner">
        <th mat-header-cell *matHeaderCellDef>
          <span
            >resourceOwner
            <mat-icon
              title="Filter Column"
              aria-label="Filter Column"
              style="
                vertical-align: middle;
                float: right;
                cursor: pointer;
                margin-right: 1em;
              "
              [ngClass]="filterActive('resourceOwner') ? 'filterActive' : ''"
              (click)="openFilterDialog('resourceOwner', filters)"
              >filter_list</mat-icon
            ></span
          >
        </th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="getMatchedClass(element)"
        >
          <span
            *ngIf="
              element.resourceOwnerUrl === '';
              then thenBlock;
              else elseBlock
            "
          ></span>
          <ng-template #thenBlock> {{ element.resourceOwner }}</ng-template>
          <ng-template #elseBlock
            ><a href="{{ element.resourceOwnerUrl }}">{{
              element.resourceOwner
            }}</a></ng-template
          >
        </td>
      </ng-container>

      <!-- Weight Column -->
      <ng-container matColumnDef="keywords">
        <th mat-header-cell *matHeaderCellDef>keywords</th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="getMatchedClass(element)"
        >
          {{ element.keywords }}
        </td>
      </ng-container>

      <!-- Symbol Column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>title</th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="getMatchedClass(element)"
        >
          {{ element.title }}
        </td>
      </ng-container>

      <ng-container matColumnDef="csvMatched">
        <th mat-header-cell *matHeaderCellDef>
          <span
            >csvMatched
            <mat-icon
              title="Filter Column"
              aria-label="Filter Column"
              style="
                vertical-align: middle;
                float: right;
                cursor: pointer;
                margin-right: 1em;
              "
              (click)="openFilterDialog('csvMatched', filters)"
              >filter_list</mat-icon
            ></span
          >
        </th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="getMatchedClass(element)"
        >
          {{ element.csvMatched }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </div>

  <button
    mat-fab
    *ngIf="csvData.length === 0"
    color="primary"
    (click)="openDialog()"
    aria-label="Upload CSV file to compare with NGR results"
    title="Upload CSV file to compare with NGR results"
    style="display: initial; position: absolute; right: 1em; bottom: 1em"
  >
    <mat-icon>upload_file</mat-icon>
  </button>
  <button
    mat-fab
    (click)="downloadResultSet()"
    *ngIf="csvData.length > 0"
    color="secondary"
    aria-label="Export current filterered results to CSV"
    title="Export current filterered results to CSV"
    style="display: initial; position: absolute; right: 1em; bottom: 1em"
  >
    <mat-icon>download</mat-icon>
  </button>
</div>
